# vCluster template for AEGIS Shadow Environments (HIGH PERFORMANCE)
# Optimized for 8 CPU / 40GB RAM Workstation
#
# This template creates isolated virtual Kubernetes clusters for fix verification
# with sufficient resources for immediate API responsiveness.
#
# Usage by AEGIS:
#   1. Create shadow: vcluster create shadow-{incident_id} -n aegis-shadows -f vcluster-template.yaml
#   2. Connect: vcluster connect shadow-{incident_id} -n aegis-shadows
#   3. Clone workloads and apply fixes
#   4. Run verification tests
#   5. Cleanup: vcluster delete shadow-{incident_id} -n aegis-shadows

# Control plane configuration
controlPlane:
  # Use k3s as the control plane (lightweight but powerful)
  distro:
    k3s:
      enabled: true

  # Give it real power so the API is responsive immediately
  statefulSet:
    resources:
      requests:
        cpu: "500m" # 0.5 Core reserved (50x more than before)
        memory: "1Gi" # 1GB RAM reserved
      limits:
        cpu: "2000m" # Burst up to 2 Cores
        memory: "4Gi" # Burst up to 4GB RAM

    # High performance disk IO settings
    persistence:
      volumeClaim:
        enabled: false # Keep using emptyDir for speed (RAM disk essentially)

    # Aggressive scheduling
    scheduling:
      podManagementPolicy: Parallel

# Networking
networking:
  # Replicate services between host and vCluster
  # This enables DNS resolution for cloned services inside shadow environment
  replicateServices:
    toHost: [] # Don't expose shadow services to host
    fromHost: [] # Sync host services marked for shadow testing

# Security Policies
policies:
  # Pod security standards
  podSecurityStandard: baseline

  # Resource quota (disabled - we have plenty of resources)
  resourceQuota:
    enabled: false # No artificial limits

# Telemetry (disable for privacy)
telemetry:
  enabled: false

# Export kubeconfig for the agent
exportKubeConfig:
  # Make kubeconfig available as secret
  secret:
    name: "vc-shadow-kubeconfig"
