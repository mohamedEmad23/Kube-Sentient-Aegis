apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: aegis-operator
  labels:
    app.kubernetes.io/name: aegis
    app.kubernetes.io/component: operator
rules:
  # Core Kubernetes resources - read access for monitoring
  - apiGroups: [""]
    resources:
      - pods
      - pods/log
      - services
      - endpoints
      - configmaps
      - secrets
      - events
      - namespaces
      - persistentvolumeclaims
      - nodes
    verbs: ["get", "list", "watch"]

  # Pods - extended permissions for remediation
  - apiGroups: [""]
    resources:
      - pods
      - pods/exec
    verbs: ["get", "list", "watch", "create", "delete", "patch"]

  # Deployments, ReplicaSets, StatefulSets, DaemonSets
  - apiGroups: ["apps"]
    resources:
      - deployments
      - replicasets
      - statefulsets
      - daemonsets
    verbs: ["get", "list", "watch", "patch", "update"]

  # Jobs and CronJobs
  - apiGroups: ["batch"]
    resources:
      - jobs
      - cronjobs
    verbs: ["get", "list", "watch", "create", "delete", "patch"]

  # Ingress
  - apiGroups: ["networking.k8s.io"]
    resources:
      - ingresses
      - networkpolicies
    verbs: ["get", "list", "watch"]

  # Custom Resource Definitions - for K8sGPT and AEGIS CRDs
  - apiGroups: ["apiextensions.k8s.io"]
    resources:
      - customresourcedefinitions
    verbs: ["get", "list", "watch"]

  # K8sGPT Results
  - apiGroups: ["core.k8sgpt.ai"]
    resources:
      - results
    verbs: ["get", "list", "watch", "patch", "update"]

  # AEGIS Custom Resources
  - apiGroups: ["aegis.io"]
    resources:
      - incidents
      - shadowenvironments
      - remediations
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

  # Kopf peering for operator coordination
  - apiGroups: ["kopf.dev"]
    resources:
      - clusterkopfpeerings
    verbs: ["get", "list", "watch", "create", "update", "patch"]

  # Events for logging operator actions
  - apiGroups: [""]
    resources:
      - events
    verbs: ["create", "patch"]

  # Namespaces - for shadow environment creation
  - apiGroups: [""]
    resources:
      - namespaces
    verbs: ["get", "list", "watch", "create", "delete"]
